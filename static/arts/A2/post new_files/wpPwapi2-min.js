var WpPwapi2=function(t){"use strict";var r=console||{log:function(){},error:function(){}},o="wpPwapi2.js",a={version000:"20180525.2",doPwapi:!0,doLocalStorage:!0,defaultCookieDomain:".washingtonpost.com",variantCookie:"wp_variant",paywallMeteringCookie:"rplm2",paywallMeteringCookieExpire:function(){return(new Date).getTime()+432e7},paywallTrackingCookie:"rplpwtrk",paywallTrackCookieExpire:function(){return(new Date).getTime()+31536e6},subscribeSubDomainIframeId:"pwapiCrsDmnLocStor_subscribe_iframe",subscribeSubDomainGetData:!1,cmdRequestGetStor:"cmdGetFromStorage",cmdRequestDeleteStor:"cmdDeleteFromStorage",cmdRequestSetStor:"cmdSetInStorage",cmdRequestGetAllStor:"cmdGetAllFromStorage",validOriginBaseDomains:["\\.washingtonpost\\.com","\\.digitalink\\.com"],validDocumentDomains:["washingtonpost.com","digitalink.com"],abTestReferrerOn:!0,abCookieName:"rplab",abRefPt:"http://pwapiptrf._pwapiptrf_.com",abTestExpire:function(){return(new Date).getTime()+864e7},abDebugCookie:"rplAbTestDebug"},i=function(e,t){return!(!e||!t)&&null!=e.match(t+"$")},n=function(e){var t,r,o,a=document.createElement("a"),i={};for(a.href=e,t=a.search.replace(/^\?/,"").split("&"),o=0;o<t.length;o++)i[(r=t[o].split("="))[0]]=r[1];return{protocol:a.protocol,host:a.host,hostname:a.hostname,port:a.port,pathname:a.pathname,search:a.search,searchObject:i,hash:a.hash}},s=function(e){if(!e)return!1;try{var t=e.getFromLocalOrSessionStorage("newsletter_history");if(!t)return!1;var a=JSON.parse(t);if(!a)return!1;var i=!0;for(var n in a)if(a.hasOwnProperty(n)){i=!1;break}if(!i)return!0}catch(e){r.error(o+" : unable to get nlHistory : "+e.message,e)}return!1},l=[{id:"rplpwabt4",active:!0,getExpireMillis:function(){return(new Date).getTime()+864e7},results:[{id:"1",min:0,max:99}],transforms:{1:function(e,t){return t}}}],c=[{id:"rplabrfg",regex:/google.com$/i,results:[{id:"t1",min:0,max:9,act:!0,processPwapiResponse:function(e){return e},referrer:"http://pwapi.rplabrfgt1.com"},{id:"t2",min:10,max:19,act:!0,processPwapiResponse:function(e){if(!this.abObj||!this.pwapi)return r.error(o+" : abTestConfig rplabrfgoog t2 this.abObj or this.pwapi is blank"),e;if(!this.abObj.regex)return r.error(o+" : abTestConfig rplabrfgoog t2 abObj this.abObj.regex blank"),e;if(!this.pwapi.originalReferrer)return r.error(o+" : abTestConfig rplabrfgoog t2 abObj this.pwapi.originalReferrer blank"),e;var t=this.abObj.regex,a=this.pwapi.originalReferrer,i=n(a).hostname;return i?(i=i.trim(),t.exec(i)?e.pwresp&&null!=e.pwresp.action&&null!=e.pwresp.url?(r.log(o+" : rplabrfg t2 orig act: "+e.pwresp.action+", url: "+e.pwresp.url),e.pwresp.action=0,e.pwresp.url="N/A",r.log(o+" : rplabrfg t2 transformed act: "+e.pwresp.action+", url: "+e.pwresp.url),e):(r.error(o+" : resData.pwresp blank"),e):e):e},referrer:"http://pwapi.rplabrfgt2.com"},{id:"f",min:20,max:99,act:!1}]}],p=[{name:"cb_clicks",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"authdrredir",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rplm2",expireOffsetMillis:432e7,cookiesToLocalStorage:!0,localStorageToCookies:!0,toPwapi:!0,notEncoded:!0},{name:"rplpwtrk",expireOffsetMillis:31536e6,cookiesToLocalStorage:!0,localStorageToCookies:!0,toPwapi:!0,notEncoded:!0},{name:"rplmct",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rplsb",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!1,toPwapi:!1},{name:"rplrol",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"osfam",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"devicetype",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"de",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"client_region",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"X-WP-Split",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rwebabt",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wp_clicks",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rpld1",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"rpld0",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wapo_actmgmt",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wpniuser",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0},{name:"wapo_login_id",expireOffsetMillis:36e5,cookiesToLocalStorage:!1,localStorageToCookies:!0,toPwapi:!0}],g=function(e){try{if(!e)return!1;if("string"==typeof e||e instanceof String){for(var t=n(e),s=0;s<a.validOriginBaseDomains.length;s++)if(i(t.hostname,a.validOriginBaseDomains[s]))return!0}else r.error(o+": isOriginValid: origin is not a string: "+JSON.stringify(e))}catch(e){r.error(o+": isOriginValid unable to process: "+e.message,e)}return!1},u=function(e,a,i){if(!(this instanceof u))return new u(e,a);if(!e){l=o+": initLocStorApi: iframeId is blank/null";throw r.error(l),new Error(l)}if(!a){l=o+": initLocStorApi: callback is blank/null";throw r.error(l),new Error(l)}var n=document.getElementById(e);if(!n){l=o+": initLocStorApi: iframe id: "+e+", iframeElement is null";throw r.error(l),new Error(l)}var s=n.contentWindow;if(!s){l=o+": initLocStorApi: iframe id: "+e+", contentWindow is null";throw r.error(l),new Error(l)}if(!i){l=o+": initLocStorApi: targetOrigin is blank";throw r.error(l),new Error(l)}if(!g(i)){var l=o+": initLocStorApi: targetOrigin is not valid";throw r.error(l),new Error(l)}this.targetOrigin=i,this.locStorApiIframeWindow=s,this.iframeEventListenerLocStorApiReference=this.locStorApiEventListener.bind({thiss:this,callback:a}),t.addEventListener("message",this.iframeEventListenerLocStorApiReference,!1)},f=function(e,t,r,o,i,n,s,l,c){if(!(this instanceof f))return new f(e,t,r,o,i,n,s,l,c);this.$jq=e,this.apiurl=t,this.cookieDomain=r,this.path=o,this.args=i,this.successCallback=n,this.errorCallback=s,this.doPwapi=l,this.doLocalStorage=c,this.timeoutMillis=15e3,r||(this.cookieDomain=a.defaultCookieDomain),i||(this.args={}),o||(this.path="/"),0!=this.path.indexOf("/")&&(this.path="/"+this.path),null==l&&(this.doPwapi=!0),null==c&&(this.doLocalStorage=!0)};f.prototype.setCallbacks=function(e,t){this.successCallback=e,this.errorCallback=t},f.prototype.storageAvailable=function(e){if(!e)return!1;try{var r=t[e],o="_wpPwapi1_js_stor_avail_";return r.setItem(o,o),r.removeItem(o),!0}catch(e){return!1}},f.prototype.allStorageAvailable=function(){var e=this.storageAvailable("localStorage"),t=this.storageAvailable("sessionStorage");return e&&t},f.prototype.getStorageData=function(t,a){if(null!=t&&null!=a&&this.allStorageAvailable()){for(var i=[],n=0;n<p.length;n++){var s=p[n],l=s.name;if(s.toPwapi&&l){var c=a.getItem(l);if(c){try{c=c.trim()}catch(e){r.error(o+" : getStorageData: unable to trim storageItemStr: "+c+", for key: "+l+" ::: "+e.message,e);continue}var g=null;try{var u=(g=JSON.parse(c)).e;if(a===localStorage&&u<(new Date).getTime()){i.push(l);continue}this.args[l]=g.v}catch(t){r.error(o+" : getStorageData: unable to json parse: "+c+", for key: "+l+" ::: "+e.message,t);continue}}}}for(n=0;n<i.length;n++)a.removeItem(i[n])}},f.prototype.getAllStorageData=function(){if(this.doLocalStorage&&a.doLocalStorage){var e=this;if(!this.allStorageAvailable())return{};var t={};return e.getStorageData(t,localStorage),e.getStorageData(t,sessionStorage),t}r.log(o+" : getAllStorageData : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+a.doLocalStorage)},f.prototype.getFromLocalOrSessionStorage=function(e){if(!this.allStorageAvailable()||!e)return null;var t=localStorage.getItem(e);return null==t&&(t=sessionStorage.getItem(e)),t},f.prototype.storeDataLocalStorage=function(e,t,r){var o={};o.v=t,o.e=r;var a=JSON.stringify(o);0===r?sessionStorage.setItem(e,a):r<0||r<(new Date).getTime()?(sessionStorage.removeItem(e),localStorage.removeItem(e)):localStorage.setItem(e,a)},f.prototype.storDelete=function(e){this.doLocalStorage&&a.doLocalStorage?this.allStorageAvailable()&&e&&this.storeDataLocalStorage(e,"",-1):r.log(o+" : storDelete : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+a.doLocalStorage)},f.prototype.storeData=function(e){if(this.doLocalStorage&&a.doLocalStorage){if(this.allStorageAvailable()){if(!e)throw"storeData: response data is null/blank";var t=e.pwresp.locstor;if(t&&!(t.length<1))for(var i=0;i<t.length;i++){var n=t[i],s=n.k,l=n.v,c=n.e;null!=s&&null!=l&&null!=c&&("string"==typeof s&&"number"==typeof c?this.storeDataLocalStorage(s,l,c):r.error(o+" : k is not string, or ex is not number for: "+JSON.stringify(n)))}}}else r.log(o+" : storeData : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+a.doLocalStorage)},f.prototype.storeDataCookies=function(e,t,r,o){var a=this;if(e){var i="",n="";if(r<0?i=";expires="+new Date(1e3).toUTCString:r>0&&(i=";expires="+new Date(r).toUTCString()),null!=a.cookieDomain&&(n=";domain="+a.cookieDomain),t||(t=""),o)s=t;else var s=encodeURIComponent(t);var l=e+"="+s+";path=/"+i+n;document.cookie=l}},f.prototype.setCookieDomain=function(e){this.cookieDomain=e||a.defaultCookieDomain},f.prototype.deleteCookie=function(e){null!=e&&""!==(e=e.trim())&&this.storeDataCookies(e,"",1e3)},f.prototype.getCookie=function(e,t){if(!e)return null;if(!t&&void 0!==this.cookieCache)return this.cookieCache[e];if(!document.cookie)return null;for(var r={},o=null,a=document.cookie.split(";"),i=0;i<a.length;i++)if(a[i].indexOf("=")>0){var n=a[i].split("="),s=n[0],l=n[1];s&&(s=s.trim()),s===e&&(l||(l=""),o=l.trim()),r[s]=l.trim()}return this.cookieCache=r,o},f.prototype.deleteAllStorageAndCookies=function(){for(var e=this,t=0;t<p.length;t++){var r=p[t].name;e.deleteCookie(r),e.storDelete(r)}},f.prototype.synchCookiesAndLocalStorage=function(){if(this.doLocalStorage&&a.doLocalStorage){if(this.allStorageAvailable())for(var e=this,t=0;t<p.length;t++){var i=p[t];try{var n=i.name,s=i.expireOffsetMillis,l=e.getCookie(n),c=localStorage.getItem(n),g=null;c&&(g=JSON.parse(c)).e<(new Date).getTime()&&(g=null,localStorage.removeItem(n));var u=null!=l,f=null!=g;if(u&&f)continue;if(u&&i.cookiesToLocalStorage){var m=(new Date).getTime()+s;e.storeDataLocalStorage(n,l,m)}else f&&i.localStorageToCookies&&e.storeDataCookies(n,g.v,g.e,i.notEncoded)}catch(e){r.error(o+" : Unable to synchCookiesAndLocalStorage for synchCookie item: "+JSON.stringify(i),e)}}}else r.log(o+" : synchCookiesAndLocalStorage : Warning: not storing data: this.doLocalStorage: "+this.doLocalStorage+", config.doLocalStorage: "+a.doLocalStorage)},f.prototype.procfn=function(e,t,a,i,n){if(e)try{i||n?e(i,n):e(a)}catch(e){r.error(o+" : "+t,e)}},f.prototype.setTimeout=function(e){e&&!isNaN(e)&&(this.timeoutMillis=e)},f.prototype.subDomainSubscribeLocStorCallback=function(e,t){var a=this;t&&t.tag?a.locstorSubscribe?"myGetTag"===t.tag&&(r.log(o+": debug subDomainSubscribeLocStorCallback: callback myGetTag: "+JSON.stringify(t)),a.locstorSubscribe.close(),a.procInternal()):r.error(o+": subDomainSubscribeLocStorCallback: self.locstorSubscribe is null"):r.error(o+": subDomainSubscribeLocStorCallback: data or data.tag is null")},f.prototype.proc=function(){var e=this;if(a.subscribeSubDomainGetData){e.locstorSubscribe=null;try{if(e.locstorSubscribe=new u(a.subscribeSubDomainIframeId,e.subDomainSubscribeLocStorCallback.bind(e)),!e.locstorSubscribe)throw new Error("pwapi.proc: self.locstorSubscribe is null");var t={cmd:e.locstorSubscribe.cmdGet(),tag:"myGetTag",keys:["wapo_login_id","wpniUser"]};e.locstorSubscribe.proc(t)}catch(e){throw e}}else e.procInternal()},f.prototype.getAbCookie=function(){var e=this.getCookie(a.abCookieName);return e?JSON.parse(decodeURIComponent(e)):null},f.prototype.abTestResponseTemplate=function(){return{res:!1,abObj:null,result:null}},f.prototype.runGenericAbnTests=function(){for(var e=this,t=[],a=0;a<l.length;a++)try{var i=l[a];if(!i.id)continue;if(null==i.active||!i.active)continue;if(!i.getExpireMillis)continue;if(!i.results||i.results.length<1)continue;var n=e.getCookie(i.id);if(n){try{(u=i.transforms[n])&&t.push(u)}catch(e){}continue}for(var s=Math.floor(100*Math.random()),c=i.results,a=0;a<c.length;a++){var p=c[a];if(p&&null!=p.id&&null!=p.min&&null!=p.max&&(s>=p.min&&s<=p.max)){var g=null;if(g="function"==typeof p.id?p.id(e):p.id){e.storeDataCookies(i.id,g,i.getExpireMillis());try{var u=i.transforms[g];u&&t.push(u)}catch(e){}}break}}}catch(e){r.error(o+" :: runGenericAbnTests, unable to process idx: "+a,e)}return t},f.prototype.abTestReferrerInternal=function(e){var t=this;if(!e)return t.abTestResponseTemplate();if(!(e=e.trim()))return t.abTestResponseTemplate();var r=n(e).hostname;if(!r)return t.abTestResponseTemplate();r=r.trim();for(var o=null,i=null,s=0;s<c.length&&(i=null,o=c[s],!(i=o.regex.exec(r)));s++)o=null;if(!o||!i)return t.abTestResponseTemplate();var l=null;if(o.id&&(l=t.getCookie(o.id),(l="t2")&&o.results)){l=l.trim();for(s=0;s<o.results.length;s++)if((m=o.results[s]).id&&m.id.trim()===l)return(h=t.abTestResponseTemplate()).abObj=o,h.result=m,"boolean"==typeof m.act?h.res=m.act:"function"==typeof m.act&&(h.res=m.act()),h}l=null;var p=Math.floor(100*Math.random()),g=o.results,u=!1,f=!1,m=null;if(!g||g.length<1)return t.abTestResponseTemplate();for(s=0;s<g.length;s++)if(m=g[s],p>=m.min&&p<=m.max){u=!0,"boolean"==typeof m.act?f=m.act:"function"==typeof m.act&&(f=m.act());break}if(u){m&&m.id&&o.id&&(l||(l=m.id),l&&t.storeDataCookies(o.id,l.trim(),a.abTestExpire()));var h=t.abTestResponseTemplate();return h.abObj=o,h.result=m,h.res=f,h}return t.abTestResponseTemplate()},f.prototype.abTestReferrer=function(e){var t=this;try{var i=t.getCookie("devicetype"),n=!1;null!=i&&"0"==i&&(n=!0);var s=t.getCookie(a.abDebugCookie);if(a.abTestReferrerOn&&n||s){var l=this.abTestReferrerInternal(e);if(l)return l}}catch(e){r.error(o+" :: unable to abTestReferrerInternal: "+e.message,e)}return t.abTestResponseTemplate()},f.prototype.getContentSection=function(){try{var e=t.wp_section;return e||(e=t.TWP.Data.Tracking.props.section),e?""==(e=e.trim())?null:e:null}catch(e){return null}},f.prototype.getSubscriberOnlyTags=function(){try{var e=t.wp_meta_data.tags_for_paywall_subs;return e?""==(e=e.trim())?null:e:null}catch(e){return null}},f.prototype.getContentTags=function(){try{var e=t.wp_meta_data.tags_for_paywall;return e?""==(e=e.trim())?null:e:null}catch(e){return null}},f.prototype.getMaxDaysToKeep=function(){var e=this.getCookie(a.variantCookie);if(e&&((e=e.split("|"))||e.length>0)){if(!(e=parseInt(e[0]))||isNaN(e))return 50;if(10===e)return(new Date).getDate()+5;if(11===e)return 35;if(12===e)return 50}return 50},f.prototype.fixMeterCookie=function(e){if(e&&-1==e.indexOf("|")){var t=e.match(/[a-z]*:[a-z0-9]+-[0-9]{0,10}-[ag]{1,2}(,[a-z0-9]+-[0-9]{0,10}-[ag]{1,2})?/g);if(t){e="";for(var r=0;r<t.length;r++)e+=t[r]+"|"}}return e},f.prototype.cleanMeterCookie=function(){var e=this,t=e.getMaxDaysToKeep(),r=this.fixMeterCookie(e.getCookie(a.paywallMeteringCookie));if(!r)return!1;for(var o=r.split("|"),n="",s=new Date,l=0;l<o.length;l++){var c=o[l];if(l>0&&n.length>0&&!i(n,"\\|")&&(n+="|"),c.trim().length>0)if(c.indexOf(",")>0&&c.indexOf(":")>0){for(var p=c.split(":")[0],g=c.split(":")[1].split(","),u="",f=0;f<g.length;f++){var m=g[f];if(m.trim().length>0)if((d=m.split("-"))&&d.length>1){var h=d[1],S=new Date(1e3*h);(b=Math.round(Math.abs((S.getTime()-s.getTime())/864e5)))<=t&&(f>0&&u.length>0&&(u+=","),u+=m)}else f>0&&u.length>0&&(u+=","),u+=m}u.length>0&&(n+=p+":"+u)}else{var d=c.split("-");if(d&&d.length>1){var h=d[1],S=new Date(1e3*h),b=Math.round(Math.abs((S.getTime()-s.getTime())/864e5));b<=t&&(n+=c)}else n+=c}}e.storeDataCookies(a.paywallMeteringCookie,n,a.paywallMeteringCookieExpire(),!0)},f.prototype.didUserHitPaywallSince=function(e){var t=this;try{if(!e)return!1;var r=t.getCookie(a.paywallTrackingCookie);if(!r)return!1;r=JSON.parse(decodeURIComponent(r));var o=(new Date).getMonth();0==o&&(o=12);var i=r[o];if(null==i)return!1;if(i>(new Date).getTime()-e)return!0}catch(e){}return!1},f.prototype.procInternal=function(){var e=this;if(this.doPwapi&&a.doPwapi){if(!e.apiurl){i=o+": apiurl is null";throw r.error(i),new Error(i)}if(!g(e.apiurl)){var i=o+": apiurl invalid";throw r.error(i),new Error(i)}e.args.referrer||(e.args.referrer=""),e.args.referrer=e.args.referrer.trim(),e.originalReferrer=e.args.referrer;var n=e.runGenericAbnTests(),l=e.getContentSection();l&&(e.args.pwapi_contentsection=l),s(e)&&(e.args.pwapi_is_nl_user="1");var c=e.getContentTags();c&&(e.args.pwapi_ct_tags=c);var p=e.getSubscriberOnlyTags();p&&(e.args.pwapi_sct_tags=p);try{e.didUserHitPaywallSince(6048e6)&&(e.args.pwapi_usr_ht_pw="1")}catch(e){r.error(o+" : Unable to check didUserHitPaywallSince in procInternal for setting pwapi_usr_ht_pw query param arg: "+e.message,e)}e.cleanMeterCookie(),e.getAllStorageData();try{e.synchCookiesAndLocalStorage()}catch(e){r.error(o+" :: unable to synchCookiesAndLocalStorage: "+e.message,e)}var u="pwapi"+Math.random().toString().substr(2);t[u]=function(a){clearTimeout(d),t.pwapiResponse=(new Date).getTime()-t.pwapiStart;try{e.storeData(a)}catch(e){r.error(o+" : Unable to local storage: "+e.message,a)}var i=a;try{if(n)for(var s=0;s<n.length;s++)try{var l=n[s];l&&(i=l(e,i))}catch(e){r.log(o+" : unable to run single transform function for generic ab tests: "+e.message,e)}}catch(e){r.error(o+" : unable run transform functions for generic ab test: "+e.message,e)}e.procfn(e.successCallback,"successCallback",i,null,null)},t.pwapiStart=(new Date).getTime();var f,m=document.createElement("script"),h=(-1===this.path.indexOf("?")?"?":"&")+"callback="+u,S="&";for(f in this.args)S+=f+"="+encodeURIComponent(this.args[f])+"&";m.src=e.apiurl+this.path+h+S,document.getElementsByTagName("head")[0].appendChild(m);var d=setTimeout(function(){console.error("PWAPI ERROR/TIMEOUT"),e.procfn(e.errorCallback,"errorCallback",null,null,"Pwapi timeout")},e.timeoutMillis)}else r.log(o+" : Warning: not calling pwapi: this.doPwapi: "+this.doPwapi+", config.pwapi: "+a.doPwapi)},u.prototype.proc=function(e){var t=this;if(!e)return r.error(o+": locStorApiCall: cmdObj is blank/null"),!1;if(!t.locStorApiIframeWindow){var a=o+": locStorApiCall: locStorApiIframeWindow is blank/null";throw r.error(a),new Error(a)}t.locStorApiIframeWindow.postMessage(JSON.stringify(e),this.targetOrigin)},u.prototype.locStorApiEventListener=function(e){var t=this;if(e&&e.origin){if(!g(e.origin))return r.error(o+": locStorApiEventListener: event origin is not valid"),void r.error(e.origin);try{t.callback(t.thiss,JSON.parse(e.data))}catch(t){r.error(o+": locStorApiEventListener: uable to call callback function with data: "+e.data+" :: err.message: "+t.message,t)}}else r.error(o+": locStorApiEventListener: ev or ev.origin is blank")},u.prototype.cmdGet=function(){return a.cmdRequestGetStor},u.prototype.cmdGetAll=function(){return a.cmdRequestGetAllStor},u.prototype.cmdDelete=function(){return a.cmdRequestDeleteStor},u.prototype.cmdSet=function(){return a.cmdRequestSetStor},u.prototype.close=function(){this.iframeEventListenerLocStorApiReference&&t.removeEventListener("message",this.iframeEventListenerLocStorApiReference,!1)};var m=t.location.href,h=n(t.location.href),S=null;try{var d=!1;if(h&&h.searchObject){var b=h.searchObject,w=b.pwapisetddmn;if(w&&"1"===w){var v=b.pwapiddmn;v&&function(e){if(!e)return!1;try{for(var t=0;t<a.validDocumentDomains.length;t++)if(e===a.validDocumentDomains[t])return!0}catch(t){r.error(o+": isDocumentDomainValid: Unable to determine for dd: "+e,t)}return!1}(v)&&(document.domain=v,d=!0),d&&(d=!(!(S=b.targetorigin)||!g(S)))}}var k=null;if(d){try{k=t.parent}catch(e){}t.addEventListener("message",function(e){try{if(!e)return;if(!g(e.origin))return;var t=e.data;if(!t)return;var i=new f;if(!i.allStorageAvailable())return void r.log(o+": Warn local/session storage not available");var n=JSON.parse(t),s=n.cmd;if(!s)return;var l={cmd:s};if(n.tag&&(l.tag=n.tag),s===a.cmdRequestGetStor){if(l.stor={},c=n.keys)for(b=0;b<c.length;b++){v=i.getFromLocalOrSessionStorage(c[b]);l.stor[c[b]]=v}}else if(s===a.cmdRequestDeleteStor){var c=n.keys;if(c)for(b=0;b<c.length;b++)i.storDelete(c[b]);l=n}else if(s===a.cmdRequestSetStor){var p=n.stor,u=(n.type,localStorage);if(p)for(var m in p)p.hasOwnProperty(m)&&u.setItem(m,p[m]);l=n}else if(s===a.cmdRequestGetAllStor){l.local={},l.session={};for(var h=localStorage.length,d=sessionStorage.length,b=0;b<h;b++){var w=localStorage.key(b),v=localStorage.getItem(w);l.local[w]=v}for(b=0;b<d;b++){var w=sessionStorage.key(b),v=sessionStorage.getItem(w);l.session[w]=v}}k&&S?k.postMessage(JSON.stringify(l),S):r.error(o+": parentWindow is null or targetOrigin is blank")}catch(t){r.error(o+": iframe message event listener unable to respond: e.origin: "+e.origin+", e.data: "+e.data+" :: err.message: "+t.message,t)}},!1)}}catch(e){r.error(o+": Unable to set document domain based on url: "+m+", err :: "+e.message,e)}return{pwapi:f,locstor:u}}(this),wpPwapi=function(e){var t=null,r=-1===(e.document.location.hostname||"subscribe.digitalink.com").indexOf("pb-dev."),o=r?"https://pwapi.washingtonpost.com":"https://testpwapi.digitalink.com",a=r?".washingtonpost.com":".digitalink.com",i={referrer:document.referrer},n=e.location.pathname+e.location.search,s=null,l=new WpPwapi2.pwapi(null,o,a,n,i,function(e){"function"==typeof callbackSuccessFunction?callbackSuccessFunction(e):s=e},function(e,r){"function"==typeof t?t(e,r):responseError={errTextStatusStr:e,errThrownStr:r}});l.registerSucccessCallback=function(e){callbackSuccessFunction=e,"object"==typeof s&&callbackSuccessFunction(s)},l.registerErrorCallback=function(e){t=e,"object"==typeof responseError&&t(e)};try{l.proc()}catch(e){console.error("Unable to call pwapi: err message: "+e.message,e)}return l}(this),WpPwapi1=function(e,t){return{pwapi:function(e,r,o,a,i,n,s,l,c){return t.registerSucccessCallback(n),t.registerErrorCallback(s),{proc:function(){}}},locstor:e.WpPwapi2.locstor}}(this,wpPwapi);
